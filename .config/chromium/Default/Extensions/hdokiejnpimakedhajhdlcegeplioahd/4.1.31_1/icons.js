function checkIconsVersion(c){var a=opendb();createDataTable(a);if(a){var d=function(b,a){var d=!0,h=null;lpGetPref("icons",-1);0<a.rows.length&&lpGetPref("icons",-1)==c&&(d=!1,h=a.rows.item(0).data);null==h||d?downloadIcons():processIcons(h)};if(g_indexeddb){var b={rows:{item:function(b){return this[b]},length:0}};a.transaction("LastPassData","readonly").objectStore("LastPassData").openCursor(IDBKeyRange.only(db_prepend(g_username_hash)+"_icons")).onsuccess=function(a){(a=a.target.result)?(b.rows[b.rows.length]=
a.value,b.rows.length++,a["continue"]()):d(null,b)}}else a.transaction(function(a){a.executeSql("SELECT * FROM LastPassData WHERE username_hash=? AND type=?",[db_prepend(g_username_hash),"icons"],d,function(a,b){console_log(b)})})}else downloadIcons()}function downloadIcons(){lpMakeRequest(base_url+"geticon.php","versionchrome=1&username="+en(g_username),lpIconResponse,null)}
function downloadBigIcons(c,a){a=a||"big";var d="big=1&versionchrome=1&username="+en(g_username)+"&size="+("big"===a?"s":a);c&&(d+="&domain="+en(c));lpMakeRequest(base_url+"geticon.php",d,function(b){if(4==b.readyState&&(200==b.status&&b.responseText)&&!("latest"==b.responsetext||"nodata"==b.responsetext))processIcons(b.responseText,a),saveBigIcons(a)},null)}
function lpIconResponse(c){if(4==c.readyState&&(200==c.status&&c.responseText)&&!("latest"==c.responsetext||"nodata"==c.responsetext)){var a=c.responseText.split("\n");c=a[0].split("=")[1];a=a[1];lpPutUserPref("icons",c);lpWriteAllPrefs();lpSaveData(a,"icons");processIcons(a)}}
function getBigIconKeyIfMissing(c,a){var d="sq"===(a||"big")?g_bigsquareicons:g_bigicons;null==BigIconList&&LoadBigIconList();var b=hostof(c),e=AES.bin2hex(b);if("undefined"!=typeof BigIconList[e])return"undefined"==typeof d[b]?b:null;b=lp_gettld_url(c);e=AES.bin2hex(b);return"undefined"!=typeof BigIconList[e]?"undefined"==typeof d[b]?b:null:null}
function checkBigIconsVersion(c,a,d,b){b=b||"big";var e=!0,f="sq"===b?g_bigsquareicons:g_bigicons,g;for(g in f){e=!1;break}if(e&&!a)LPPlatform.getBigIcons(function(a){a?(processIcons(a,b),checkBigIconsVersion(c,!0,d,b)):downloadBigIcons("all",b)},b);else if(c)a=getBigIconKeyIfMissing(c,b),null!=a&&downloadBigIcons(a,b);else{e=!1;f=[];g=[];for(var h in g_sites)e=!0,a=getBigIconKeyIfMissing(g_sites[h].url,b),null!=a&&"undefined"==typeof g[a]&&(g[a]=1,f[f.length]=a);!e&&!d?downloadBigIcons("all",b):
f.length&&downloadBigIcons(f.join(","),b)}}function processIcons(c,a){var d=null;if(c&&(c=c.split(":"),a&&(d="sq"===a?g_bigsquareicons:g_bigicons),c.length)){var b=c[0],e=0;for(a=c.length;e+1<a;e+=2){var f=parseInt(c[e+1]);if(0===b.indexOf("lp")&&0<f){var b=b.substring(2),g=c[e+2].substring(0,f);a?d[AES.hex2bin(b)]=g:g_icons[b]=g;b=c[e+2].substring(f)}}}LPPlatform.updateBigIcons(d)}
function saveBigIcons(c){var a="sq"===c?g_bigsquareicons:g_bigicons,d="",b;for(b in a)var e=a[b],d=d+("lp"+AES.bin2hex(b)+":"+e.length+":"+e);LPPlatform.saveBigIcons(d,c)};
